<html>
	<head>
		<title>Rectangle</title>
	</head>
	<body   bgcolor=white>
	<input id="gravityButton" type="button" onclick="toggleGravity()" value="Disable Gravity">
	<input id="bounceButton" type="button" onclick="toggleBounce()" value="Enable Bounce">
	<input id="boundaryButton" type="button" onclick="toggleBoundary()" value="Disable Boundaries">
	<input type="button" onclick="location.href='Three.js/3Dcube.html';" value="WebGL" />
	<h1><i>Rectangle in Rectangle</i></h1>

		<canvas id="Rectangle" width=700 height=500 style="border:2px solid #000000;"></canvas>
		
		<script type="text/javascript">

				var canvas;
				var context;

				var rectSize=50;
				var rectX=50;
				var rectY=20;
				var acceleration=0.3;

				var gravity=0.4;
				var friction=0.05;

				var inertiaX=0;
				var inertiaY=0;

				var moveUp=false;
				var moveDown=false;
				var moveLeft=false;
				var moveRight=false;

				var mouseClick=false;
				var mouseX = 0;
				var mouseY = 0;

				var gravityEnabled=true;
				var bounceEnabled=false;
				var boundary=true;

				var inAir = true;

				var screenWidth;//=canvas.width;
				var screenHeight;//=canvas.height;

				var dragok=false;

				function init()
				{

					canvas = document.getElementById( "Rectangle");
    				context = canvas.getContext( "2d" );

					document.addEventListener( "keydown" ,doKeyDown ,false);
   					document.addEventListener( "keyup"   ,doKeyUp   ,false);
   					document.addEventListener("mousedown",myDown ,false);
   					document.addEventListener("mouseup"  ,myUp   ,false);

   					screenWidth=canvas.width;
   					screenHeight=canvas.height;

					window.requestAnimationFrame(doStuff);
				}
				function doStuff()
				{
    				context.clearRect( 0, 0, screenWidth, screenHeight );

    				if(moveUp)
	    				{
	    					inertiaY-=2*acceleration;
	    				}
	    			if(moveDown)
	    				{
	    					inertiaY+=2*acceleration;
	    				}
	    			if(moveLeft)
	    				{
	    					if(gravityEnabled==false)
	    					{
	    						inertiaX-=2*acceleration;
	    					}
	    					else if(inAir)
	    					{
	    						inertiaX-=1.5*acceleration;
	    					}
	    				}
	    			if(moveRight)
	    				{
	    					if(gravityEnabled==false)
	    					{
	    						inertiaX+=2*acceleration;
	    					}
	    					else 
	    						{
	    							if(inAir)
	    							{
	    								inertiaX+=2*acceleration;
	    							}
	    							else inertiaX+=1.5*acceleration;
	    						}	
	    				}
					if(moveLeft)
	    			{
	    				if(gravityEnabled==false)
	    				{
	    					inertiaX-=2*acceleration;
	    				}
	    				else 
	    					{
	    						if(inAir)
	    						{
	    							inertiaX-=2*acceleration;
	    						}
	    						else inertiaX-=1.5*acceleration;
	    					}	
	    			}
	    			if(gravityEnabled)
	    			{
	    				inertiaY+=gravity;
	    				if(inAir==false&&inertiaX<0)
	    				{
	    					inertiaX+=friction;
	    				}
	    				if(inAir==false&&inertiaX>0)
	    				{
	    					inertiaX-=friction;
	    				}
	    			}

	    			rectY+=inertiaY;

	    			rectX+=inertiaX;

	    			if(rectX<0)
	    			{
	    				if(boundary)
	    				{
	    					if(bounceEnabled==true)
	    					{
	    						inertiaX=-inertiaX;
	    					}
	    					else
	    					{
	    						rectX=0;
	    						inertiaX=0;
	    					}
	    				}
	    				else
	    				{
	    					rectX=screenWidth-rectSize;
	    				}
	    			}
	    			if(rectX+rectSize>screenWidth)
	    			{
	    				if(boundary)
	    				{
	    					if(bounceEnabled==true)
	    					{
	    						inertiaX=-inertiaX;
	    					}
	    					else
	    					{
	    						rectX=screenWidth-rectSize;
	    						inertiaX=0;
	    					}
	    				}
	    				else
	    				{
	    					rectX=0;
	    				}
	    			}
	    			if(rectY<0)
	    			{
	    				if(boundary)
	    				{
	    					if(bounceEnabled==true)
	    					{
	    						rectY=0;
	    						inertiaY=-inertiaY;
	    						inAir=true;
	    					}
	    					else
	    					{
	    						rectY=0;
	    						inertiaY=0;
	    					}
	    				}
	    				else
	    				{
	    					rectY=screenHeight-rectSize;
	    				}
	    			}
	    			if(rectY+rectSize>screenHeight)
	    			{
	    				if(boundary)
	    				{
	    					if(bounceEnabled==true)
	    					{
	    						rectY=screenHeight-rectSize;
	    						inertiaY=-inertiaY;
	    					}
	    					else
	    					{
	    						rectY=screenHeight-rectSize;
	    						inertiaY=0;
	    						inAir=false;
	    					}
	    				}
	    				else
	    				{
	    					rectY=0;
	    				}
	    			}

	    			/*if(mouseClick==true)
	    			{
	    				
	    					document.addEventListener("mousedown",mouseDown     ,false);
   							document.addEventListener("mouseup",mouseUp     ,false);
						if(mouseY>rectY&&mouseX>rectX&&mouseY<rectY+rectSize&&mouseX<rectX+rectSize)
						{
							rectY=mouseY;
							rectX=mouseX;	
	    				}
	    			}*/
    				drawRect();
					window.requestAnimationFrame(doStuff);
				}
				function drawRect()
				{
					context.fillStyle="#FF0000";
					context.beginPath();
					context.rect(rectX,rectY,rectSize,rectSize);
					context.fillRect(rectX,rectY,rectSize,rectSize);
					context.stroke();
				}

				function doKeyDown(event)
				{
				    switch (event.keyCode)
				    {

				        case 87 : moveUp    = true; break;
				        case 38 : moveUp    = true; break;

				        case 83 : moveDown  = true; break;
				        case 40 : moveDown  = true; break;

				        case 65 : moveLeft  = true; break;
				        case 37 : moveLeft  = true; break; 

				        case 68 : moveRight = true; break; 
				        case 39 : moveRight = true; break; 
				    }
				}

				function doKeyUp( vent)
				{
				    switch (event.keyCode)
				    {
				        case 87 : moveUp    = false; break;
				        case 38 : moveUp    = false; break;

				        case 83 : moveDown  = false; break;
				        case 40 : moveDown  = false; break;

				        case 65 : moveLeft  = false; break;
				        case 37 : moveLeft  = false; break; 

				        case 68 : moveRight = false; break; 
				        case 39 : moveRight = false; break; 
				    }
				}

				/*function mouseDown(event)
				{
					mouseClick=true;
					//mouseX = event.clientX-canvas.getBoundingClientRect().left;
					//mouseY = event.clientY-canvas.getBoundingClientRect().top;
					/*var mouseX = event.clientX-canvas.getBoundingClientRect().left;
					var mouseY = event.clientY-canvas.getBoundingClientRect().top;

					if(mouseY>rectY&&mouseX>rectX&&mouseY<rectY+rectSize&&mouseX<rectX+rectSize)
					{
						mouseClick=true;
					}
					rectY=mouseY;
					rectX=mouseX;
				}
				function mouseUp(event)
				{
					mouseClick=false;
				}*/
				function toggleGravity()
				{
					if(gravityEnabled==true)
					{
						gravityEnabled=false;
						document.getElementById("gravityButton").value="Enable Gravity";
					}
					else 
						{
							gravityEnabled=true;
							document.getElementById("gravityButton").value="Disable Gravity";
						}
				}

				function toggleBounce()
				{
					if(bounceEnabled==true)
					{
						bounceEnabled=false;
						document.getElementById("bounceButton").value="Enable Bounce";
					}
					else
					{ 
						bounceEnabled=true;
						document.getElementById("bounceButton").value="Disable Bounce";
					}
				}

				function toggleBoundary()
				{
					if(boundary==true)
					{
						boundary=false;
						document.getElementById("boundaryButton").value="Enable Boundaries";
					}
					else
					{
						boundary=true;
						document.getElementById("boundaryButton").value="Disable Boundaries";
					}
				}

				/* function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
      x: evt.clientX - rect.left,
      y: evt.clientY - rect.top
    };
  }
  canvas.addEventListener('mousemove', function(evt) {
    var mousePos = getMousePos(canvas, evt);
    console.log('Mouse position: ' + mousePos.x + ',' + mousePos.y);
  }, false);*/
				function myMove(event)
				{
 					if (dragok)
 						{
  							rectX = event.clientX-canvas.getBoundingClientRect().left;
  							rectY = event.clientY-canvas.getBoundingClientRect().top;
						}
				}

				function myDown(event)
				{
					mouseX = event.clientX-canvas.getBoundingClientRect().left;
					mouseY = event.clientY-canvas.getBoundingClientRect().top;
 					if (mouseY>rectY&&mouseX>rectX&&mouseY<rectY+rectSize&&mouseX<rectX+rectSize) /* + canvas.getBoundingClientRect().left && event.clientX > rectX  + canvas.offsetLeft && event.pageY < rectY  + canvas.offsetTop && event.pageY > rectY  + canvas.offsetTop)*/
 					{
 						//alert("er");
 						rectX = event.pageX - canvas.offsetLeft;
  						rectY = event.pageY - canvas.offsetTop;
  						dragok = true;
  						//document.addEventListener("onmousemove"  ,myMove   ,false);
 						canvas.onmousemove = myMove;
 						//alert("re");
 					}
				}
				function myUp()
				{
 					dragok = false;
					canvas.onmousemove = null;
				}
		init();
		//canvas.onmousedown = myDown;
		//canvas.onmouseup = myUp;
		</script>

		<p>
		TO DO <br>
		Toggle gravity button  - done<br>

 		Friction has to be low number, need fix<br>

 		Bouncy Bouncy - done <br>

 		Boundaries - done <br>

 		Fix mouse click <br>
 		</p>
	</body>
</html>

